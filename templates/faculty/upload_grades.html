{% extends "dashboard/base.html" %}
{% load static custom_filters %}

{% load static %}

{% block content %}
<h2>
    Submit Marks â€“
    {{ offering.course.course_code }}
    (Y{{ offering.year }}{{ offering.section }})
</h2>

<form method="post">
    {% csrf_token %}

    <table class="data-table">
        <thead>
            <tr>
                <th>Roll No</th>
                <th>Name</th>
                <th>Total Marks</th>
                <th>Status</th>
            </tr>
        </thead>

        <tbody>
            {% for student in students %}
            {% with submission=submissions|get_item:student.id %}
            <tr>
                <td>{{ student.username }}</td>
                <td>{{ student.get_full_name|default:"-" }}</td>

                <td>
                    {% if submission and submission.is_locked %}
                        {{ submission.total_marks }}
                    {% else %}
                        <input
                            type="number"
                            name="marks_{{ student.id }}"
                            step="0.01"
                            value="{{ submission.total_marks|default_if_none:'' }}"
                            style="width: 90px;"
                        >
                    {% endif %}
                </td>

                <td>
                    {% if submission and submission.is_locked %}
                        <span class="status locked">Locked</span>
                    {% else %}
                        <span class="status editable">Editable</span>
                    {% endif %}
                </td>
            </tr>
            {% endwith %}
            {% endfor %}
        </tbody>
    </table>

    <div style="margin-top: 20px;">
        <button type="submit" class="btn-primary">
            Save Marks
        </button>

        <button
            type="submit"
            name="final_submit"
            value="1"
            class="btn-danger"
            onclick="return confirm('Once submitted, marks cannot be edited. Continue?');"
        >
            Final Submit & Lock
        </button>
    </div>
</form>
{% endblock %}
